var $jscomp={scope:{},checkStringArgs:function(a,c,b){if(null==a)throw new TypeError("The 'this' value for String.prototype."+b+" must not be null or undefined");if(c instanceof RegExp)throw new TypeError("First argument to String.prototype."+b+" must not be a regular expression");return a+""}};
$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(a,c,b){if(b.get||b.set)throw new TypeError("ES3 does not support getters and setters.");a!=Array.prototype&&a!=Object.prototype&&(a[c]=b.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(a,c,b,e){if(c){b=$jscomp.global;a=a.split(".");for(e=0;e<a.length-1;e++){var d=a[e];d in b||(b[d]={});b=b[d]}a=a[a.length-1];e=b[a];c=c(e);c!=e&&null!=c&&$jscomp.defineProperty(b,a,{configurable:!0,writable:!0,value:c})}};$jscomp.polyfill("String.prototype.includes",function(a){return a?a:function(a,b){return-1!==$jscomp.checkStringArgs(this,a,"includes").indexOf(a,b||0)}},"es6-impl","es3");
var express=require("express"),bodyParser=require("body-parser"),logger=require("morgan"),emojiRegex=require("emoji-regex"),nodeEmoji=require("node-emoji"),slack=require("slack"),moment=require("moment"),app=express(),port=process.env.PORT||5E3;app.use(logger("dev"));app.use(bodyParser.urlencoded({extended:!0}));app.use(bodyParser.json());var router=express.Router();
app.post("/",function(a,c,b){if(a.body.token&&a.body.token===process.env.SECRET_TOKEN){clearTimeout(timer);var e=process.env.SLACK_TOKEN;console.log(a.body);var d=a.body.title;b=moment(a.body.start,"MMM D, YYYY [at] hh:mmA");a=moment(a.body.end,"MMM D, YYYY [at] hh:mmA");wizardStatusStartTime=1E3*a.diff(b,"seconds");d.includes("Woo Chat")&&(console.log("Setting snooze"),console.log(d),slack.dnd.setSnooze({token:e,num_minutes:a.diff(b,"minutes")-2}));var f=":chat-green:";d.match("Reserve")&&(f=":happychat:");
d.match("Tickets")&&(f=":zendesk2:");d=d+" from "+b.format("h:mm")+" to "+a.format("h:mm a");b=JSON.stringify({status_text:d,status_emoji:f,status_expiration:a.utcOffset(-10,!0).unix()});console.log(b);slack.users.profile.set({token:e,profile:b});time=a.unix()+30;text="shift over";slack.reminders.add({token:e,text:text,time:time});console.log("setting reminder to go red for "+time);c.status(200);c.send("\ud83e\udd18");console.log("scheduling wizard status for "+wizardStatusStartTime+" ms from now");
timer=setTimeout(function(){d="My hat is deep and full of magic";f=":partywizard:";expiration=0;var a=JSON.stringify({status_text:d,status_emoji:f,status_expiration:expiration});console.log(a);slack.users.profile.set({token:e,profile:a})},wizardStatusStartTime)}else b()});
app.get("/",function(a,c,b){c.send('\n    <!DOCTYPE html>\n    <html>\n      <head>\n        <meta charset="utf-8">\n        <title>Welcome!</title>\n        <style>\n          pre {\n            background-color: #DDD;\n            padding: 1em;\n            display: inline-block;\n          }\n        </style>\n      </head>\n      <body>\n        <h1>Your Heroku server is running!</h1>\n        <p>You\'ll need the following information for your IFTTT recipe:</p>\n        <h3>Body</h3>\n<pre>{\n  "title":"<<<{{Title}}>>>",\n  "start":"{{Starts}}",\n  "end":"{{Ends}}",\n  "token": "'+process.env.SECRET_TOKEN+
'"\n}</pre>\n      </body>\n    </html>\n  ')});app.use(function(a,c,b){c.status(404);c.send("Not found")});app.listen(port);console.log("Server running on port "+port);
